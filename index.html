<!doctype html>
<html>
<head>
<title>dwim</title>

<script src="utils.js"></script>
<script src="graphics.js"></script>
<script src="dwim.js"></script>

<style>
body {
  background-color: black;
}

div.status {
  font-family: monospace;
  color: white;
}

span.error {
  color: red;
}

span.att {
  color: yellow;
}

a {
  color: blue;
}

</style>
</head>

<body>
<div class="status" id="status1">Not running</div>
<div class="status" id="status2"></div>
<canvas width="640" height="480" id="level"></canvas>

<script>
(function(){

levels = {
b: {
  startpos: {x: 0, y: 5},
  exitpos: {x: 9, y: 9},
  dims: {w: 10, h: 10},
  programs: [
    {code: 'ccdcc',
     loc: '3-5,5 5-6,4'}
  ],
  obstacles: [
    '2-7,0-3 3-6,4-6 2-7,7-9'
  ],
  available_mappings: [ ],
},
// 0, intro?
'0': {
  dims: {w: 10, h: 10},
  startpos: {x: 0, y:0},
  exitpos: {x:5, y:5},
  programs: [
    {code: 'cccc', loc: '1,3-6'},
    {code: 'ssss', loc: '3-6,8'},
    {code: 'dddd', loc: '8,3-6'},
    {code: 'hhcccsshc', loc: '4-6,1 4,2-4 5-6,4'},
  ],
  obstacles: [
    '0-9,3-6',
    '3-6,0-9'
  ],
  available_mappings: [],
  next_level: '1',
},
// 1, can change dir
'1': {
  dims: {w: 9, h: 9},
  startpos: {x: 0, y: 4},
  exitpos: {x: 4, y: 7},
  obstacles: [ '2,0-9', '6,0-9' ],
  programs: [
    {loc: '2-6,3', code: 'dssss' },
  ],
  available_mappings: [],
  next_level: '2',
},
// 2, redundant dir change
'2': {
  dims: {w: 10, h: 8},
  startpos: {x: 0, y: 0},
  exitpos: {x: 0, y: 5},
  programs: [
    {code: 'ccddsddccc',
     loc: '3-5,0 5,1-2 4,2-4 5-6,4'},
    {code: 'hdsssss',
     loc: '3-7,6'},
  ],
  obstacles: [
    '0-5,2 5-6,5-6 3-6,0-8'
  ],
  available_mappings: [],
  next_level: '3',
},
// 3, tricky dir change
'3': {
  dims: {w: 8, h: 8},
  startpos: {x: 0, y: 0},
  exitpos: {x: 7, y: 7},
  programs: [
    {code: 'cc', loc: '0-1,1 1,0'},
    {code: 'ss', loc: '0-3,3 3,0-3'},
    {code: 'ss', loc: '4-5,6'},
    {code: 'cc', loc: '6,4-5'},
    {code: 'c', loc: '7,6'},
    {code: 's', loc: '6,7'},
  ],
  obstacles: [
    '4-5,4-7 4-7,4-5'
  ],
  available_mappings: [],
  next_level: '4',
},
// 4, one way out
'4': {
  dims: {w: 9, h: 9},
  startpos: {x: 4, y: 4},
  exitpos: {x: 8, y: 4},
  obstacles: [
    '5-6,1-7 1-3,1-3 1-3,5-7 8,1-7',
  ],
  programs: [
    {code: 'hcs', loc: '1-3,4'},
    {code: 'dsc', loc: '4,1-3'},
    {code: 'csd', loc: '4,5-7'},
    {code: 'd', loc: '7,4'}
  ],
  available_mappings: [],
  next_level: 'end',
},
};

var level_cnv = document.getElementById('level');
var status1_div = document.getElementById('status1');
var status2_div = document.getElementById('status2');

var game = new Dwim( level_cnv, status1_div, status2_div );

var level_id = window.location.search;
if (level_id !== '0' && !level_id) {
  level_id = '0';
} else {
  level_id = level_id.substr(1);
}

if (level_id === 'end') {
  status1_div.innerHTML = "That's all for now";
  status2_div.innerHTML = "Thanks for playing!";
} else {
  console.log('start level ' + level_id);

  game.start(levels[level_id]);
}

})();
</script>
</body>
</html>
