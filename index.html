<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>dwim</title>

<script src="utils.js"></script>
<script src="graphics.js"></script>
<script src="dwim.js"></script>

<style>
body {
  background-color: black;
  color: white;
}

a {
  color: blue;
}
a.fake-link {
  text-decoration: underline;
  cursor: pointer;
}

div#instructions {
  display: none;
}

</style>
</head>

<body>
<a id="instructions-link" class="fake-link"
   onclick="getElementById('instructions-link').style.display='none'; getElementById('instructions').style.display='block';">Instructions</a>
<div id="instructions">
Get to the star.<br>
Arrow keys to move.<br>
Number keys (1,2,3 ...) to switch modes.<br>
Mouse over a <span style="background-color: #404040;">program region</span> to view its code.<br>
You can reload this page to retry if you get stuck.
</div>

<div id="game1"></div>
<script>
(function(){

levels = {
// 0
'0': {
  dims: {w: 10, h: 10},
  startpos: {x: 0, y: 8},
  exitpos: {x: 7, y: 9},
  obstacles: ['0,0-3 0-1,7 1,8 1-2,5 3-6,5-9 6,0-1 6,3-4 8,1 8-9,3-9'],
  programs: [
    {code: 'ggb', loc: '0,4-6'},
    {code: 'rrrggbbppp', loc: '6-9,2 7-9,0 7,1 9,1'},
    {code: 'rgbp', loc: '7,5-8'}
  ],
  mappings: [
    {lookup: {r: {type: 'move', dir: LEFT},
              g: {type: 'move', dir: UP},
              b: {type: 'move', dir: RIGHT},
              p: {type: 'move', dir: DOWN}},
              symbols: ['r','g','b','p']},
    {lookup: {r: {type: 'move', dir: RIGHT},
              g: {type: 'move', dir: UP},
              b: {type: 'move', dir: LEFT},
              p: {type: 'move', dir: DOWN}},
              symbols: ['r','g','b','p']},
    {lookup: {r: {type: 'move', dir: DOWN},
              g: {type: 'move', dir: DOWN},
              b: {type: 'move', dir: DOWN},
              p: {type: 'move', dir: DOWN}},
              symbols: ['r','g','b','p']}],
  next_level: '2'
},

// 2
'2': {
  dims: {w: 10, h: 10},
  startpos: {x: 1, y: 3},
  exitpos: {x: 3, y: 8},
  obstacles: ['0,0-4 3-4,1 6-7,1 0-9,5-6 4,4 6,4 0-4,7 6-9,7 0-2,8-9 8-9,8-9 3-7,9'],
  programs: [
    {code: 'rrrrrr', loc: '5,1'},
    {code: 'rr', loc: '5,4-6'},
    {code: 'bb', loc: '4-6,8'}],
  mappings: [
    {lookup: {r: {type: 'move', dir: UP},
              b: {type: 'move', dir: LEFT}},
             symbols: ['r','b']},
    {lookup: {r: {type: 'move', dir: DOWN},
              b: {type: 'move', dir: UP}},
             symbols: ['r','b']}],
  next_level: '3'
},

// old 0
'0old': {
  dims: {w: 10, h: 10},
  startpos: {x: 0, y:0},
  exitpos: {x:5, y:5},
  programs: [
    {code: 'cccc', loc: '1,3-6'},
    {code: 'ssss', loc: '3-6,8'},
    {code: 'dddd', loc: '8,3-6'},
    {code: 'hhcccsshc', loc: '4-6,1 4,2-4 5-6,4'},
  ],
  obstacles: [
    '0-9,3-6',
    '3-6,0-9'
  ],
  mappings: [{lookup: {}, symbols: []}],
  next_level: '1',
},

// 1, can change dir
'1old': {
  dims: {w: 9, h: 9},
  startpos: {x: 0, y: 4},
  exitpos: {x: 4, y: 7},
  obstacles: [ '2,0-8', '6,0-8' ],
  programs: [
    {loc: '2-6,3', code: 'dssss' },
  ],
  mappings: [{lookup: {}, symbols: []}],
  next_level: '2',
},
// 2, redundant dir change
'2old': {
  dims: {w: 10, h: 8},
  startpos: {x: 0, y: 0},
  exitpos: {x: 0, y: 5},
  programs: [
    {code: 'ccddsddccc',
     loc: '3-5,0 5,1-2 4,2-4 5-6,4'},
    {code: 'hdsssss',
     loc: '3-7,6'},
  ],
  obstacles: [
    '0-5,2 5-6,5-6 3-6,0-7',
    '0-2,3-4',
    '7-9,0-2'
  ],
  mappings: [{lookup: {}, symbols: []}],
  next_level: '3',
},
// 3, tricky dir change
'3old': {
  dims: {w: 8, h: 8},
  startpos: {x: 0, y: 0},
  exitpos: {x: 7, y: 7},
  programs: [
    {code: 'cc', loc: '0-1,1 1,0'},
    {code: 'ss', loc: '0-3,3 3,0-3'},
    {code: 'ss', loc: '4-5,6'},
    {code: 'cc', loc: '6,4-5'},
    {code: 'c', loc: '7,6'},
    {code: 's', loc: '6,7'},
  ],
  obstacles: [
    '4-5,4-7 4-7,4-5'
  ],
  mappings: [{lookup: {}, symbols: []}],
  next_level: '4',
},
// 4, one way out
'4old': {
  dims: {w: 9, h: 9},
  startpos: {x: 4, y: 4},
  exitpos: {x: 8, y: 4},
  obstacles: [
    '5-6,1-7 1-3,1-3 1-3,5-7 8,0-8',
  ],
  programs: [
    {code: 'hcs', loc: '1-3,4'},
    {code: 'dsc', loc: '4,1-3'},
    {code: 'csd', loc: '4,5-7'},
    {code: 'd', loc: '7,4'}
  ],
  mappings: [{lookup: {}, symbols: []}],
  next_level: '5',
},
// 5, mapping change
'5old': {
  dims: {w: 9, h: 9},
  startpos: {x: 8, y: 1},
  exitpos: {x: 8, y: 8},
  obstacles: [
    '4-8,2 3-5,0-8 4-8,6 3-5,4-8 4-8,4',
    '0-1,0-8',
    '8,3-5',
    '2,0 2,4 2,8'
  ],
  programs: [
    {code: 'ccc', loc: '3-5,1'},
    {code: 'dccc', loc: '3-5,3'},
    {code: 's', loc: '7,4'},
    {code: 'ccssdccc', loc: '3-5,5 3-5,7 3,6'}
  ],
  mappings: [{lookup: {}, symbols: []},
             {lookup: {}, symbols: []}],
  next_level: 'end',
},
};

var level_id = window.location.search;
if (level_id !== '0' && !level_id) {
  level_id = '0';
} else {
  level_id = level_id.substr(1);
}

var game = new Dwim(
  document.getElementById('game1'),
  levels[level_id],
  level_id
);

game.startRender()

})();
</script>
</body>
</html>
